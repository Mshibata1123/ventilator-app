<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; media-src 'self' data:; connect-src 'self';">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
    <title>ğŸ¥ äººå·¥å‘¼å¸å™¨ã‚¢ãƒ©ãƒ¼ãƒ å¯¾å¿œãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚¢ãƒ—ãƒª</title>
  <style>
        :root {
            --bg: #0a0e1a;
            --card: #1a1f2e;
            --accent: #00d4ff;
            --success: #00ff88;
            --warning: #ffb800;
            --danger: #ff4757;
            --muted: #94a3b8;
            --text: #f1f5f9;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            margin: 0;
            background: linear-gradient(135deg, #0a0e1a 0%, #1a1f2e 50%, #0f1419 100%);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(0,212,255,0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(118,75,162,0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .app {
            width: 100%;
            max-width: 1400px;
            animation: fadeInUp 0.8s ease-out;
        }

        .card {
            background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient);
        }

        header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .logo {
            width: 70px;
            height: 70px;
            border-radius: 15px;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 24px;
            color: white;
            box-shadow: 0 10px 20px rgba(0,212,255,0.3);
            animation: pulse 2s infinite;
        }

        .header-content h1 {
            margin: 0;
            font-size: 28px;
            color: var(--text);
            font-weight: 700;
        }

        .header-content p {
            margin: 5px 0 0;
            color: var(--muted);
            font-size: 16px;
        }

        .start-screen {
            text-align: center;
            padding: 40px;
        }

        .start-screen h2 {
            font-size: 32px;
            margin-bottom: 20px;
            color: var(--accent);
        }

        .start-screen p {
            font-size: 18px;
            color: var(--muted);
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .start-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .scenario-container {
            display: none;
        }

        .scenario-container.active {
            display: block;
        }

        .scenario-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .alarm-badge {
            display: inline-block;
            padding: 10px 16px;
            border-radius: 25px;
            background: linear-gradient(135deg, var(--danger), #ff6b6b);
            font-weight: 700;
            color: white;
            font-size: 14px;
            box-shadow: 0 5px 15px rgba(255,71,87,0.3);
            animation: glow 2s infinite alternate;
        }

        .progress-info {
            color: var(--muted);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .quiz-section {
            background: linear-gradient(145deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(5px);
            display: flex;
            flex-direction: column;
        }

        .media-section {
            background: linear-gradient(145deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(5px);
        }

        .media {
            border-radius: 12px;
            overflow: hidden;
            height: 350px;
            background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
            padding: 10px;
        }

        .media video {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 8px;
            background: rgba(0,0,0,0.1);
        }

        .media-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        .control-btn {
            background: linear-gradient(145deg, rgba(0,212,255,0.2), rgba(0,212,255,0.1));
            border: 1px solid var(--accent);
            color: var(--accent);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: var(--accent);
            color: white;
        }

        .quiz-content {
            flex: 1;
        }

        .quiz-actions {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }

        .question {
            font-size: 20px;
            margin-bottom: 20px;
            line-height: 1.6;
            color: var(--text);
            font-weight: 600;
        }

        .choices {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .choice {
            background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
            padding: 15px;
            border-radius: 12px;
            border: 2px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .choice:hover {
            background: linear-gradient(145deg, rgba(0,212,255,0.1), rgba(0,212,255,0.05));
            border-color: var(--accent);
            transform: translateX(5px);
        }

        .choice input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.2);
            accent-color: var(--accent);
        }

        .choice label {
            cursor: pointer;
            display: flex;
            align-items: center;
            width: 100%;
            font-size: 16px;
            line-height: 1.4;
        }

        .choice:hover label {
            color: var(--text);
        }

        .choice.correct {
            background: linear-gradient(145deg, rgba(0,255,136,0.2), rgba(0,255,136,0.1));
            border-color: var(--success);
        }

        .choice.incorrect {
            background: linear-gradient(145deg, rgba(255,71,87,0.2), rgba(255,71,87,0.1));
            border-color: var(--danger);
        }

        .explanation {
            margin-top: 15px;
            padding: 15px;
            border-radius: 12px;
            background: linear-gradient(145deg, rgba(0,212,255,0.1), rgba(0,212,255,0.05));
            border-left: 4px solid var(--accent);
            animation: slideInUp 0.5s ease-out;
            max-width: 90%;
            margin-left: auto;
            margin-right: auto;
        }

        .explanation h4 {
            margin: 0 0 10px;
            color: var(--accent);
            font-size: 16px;
        }

        .explanation p {
            margin: 0;
            color: var(--text);
            line-height: 1.6;
        }

        .result-banner {
            text-align: center;
            padding: 15px 20px;
            margin: 15px auto;
            border-radius: 15px;
            font-size: 20px;
            font-weight: 700;
            animation: resultPulse 0.8s ease-out;
            max-width: 80%;
        }

        .result-banner.correct {
            background: linear-gradient(145deg, rgba(0,255,136,0.2), rgba(0,255,136,0.1));
            color: var(--success);
            border: 2px solid var(--success);
            box-shadow: 0 10px 30px rgba(0,255,136,0.3);
        }

        .result-banner.incorrect {
            background: linear-gradient(145deg, rgba(255,71,87,0.2), rgba(255,71,87,0.1));
            color: var(--danger);
            border: 2px solid var(--danger);
            box-shadow: 0 10px 30px rgba(255,71,87,0.3);
        }

        .result-icon {
            font-size: 28px;
            margin-bottom: 8px;
            display: block;
            animation: bounce 1s infinite;
        }

        @keyframes resultPulse {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .btn-primary {
            background: var(--gradient);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            color: var(--text);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .btn-secondary:hover {
            background: linear-gradient(145deg, rgba(255,255,255,0.15), rgba(255,255,255,0.08));
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #ff6b6b);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255,71,87,0.4);
        }

        /* Mobile/touch optimizations */
        html, body {
            -webkit-text-size-adjust: 100%;
        }
        button, .control-btn, .btn, .choice {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        @media (max-width: 768px) {
            .choice { padding: 18px; }
            .choice input[type="radio"] { width: 22px; height: 22px; }
            .choice label { font-size: 15px; }
            .btn, .control-btn { padding: 14px 18px; font-size: 16px; }
        }

        .completion-screen {
            text-align: center;
            padding: 20px;
            background: linear-gradient(145deg, rgba(0,255,136,0.1), rgba(0,212,255,0.1));
            border-radius: 20px;
            border: 2px solid var(--success);
            box-shadow: 0 20px 40px rgba(0,255,136,0.3);
            animation: celebration 1s ease-out;
            max-height: 80vh;
            overflow-y: auto;
        }

        .completion-title {
            font-size: 28px;
            font-weight: 800;
            color: var(--success);
            margin-bottom: 15px;
            animation: bounceIn 1.2s ease-out;
        }

        .completion-message {
            font-size: 18px;
            color: var(--text);
            margin-bottom: 20px;
            line-height: 1.4;
            animation: bounceIn 1.4s ease-out;
        }

        .completion-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .stat-item {
            background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent);
            display: block;
        }

        .stat-label {
            font-size: 12px;
            color: var(--muted);
            margin-top: 5px;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--accent);
            animation: confetti 3s linear infinite;
        }

        .confetti:nth-child(odd) {
            background: var(--success);
        }

        .confetti:nth-child(3n) {
            background: var(--warning);
        }

        .confetti:nth-child(4n) {
            background: var(--danger);
        }

        @keyframes celebration {
            0% {
                transform: scale(0.8) rotate(-5deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.1) rotate(2deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        @keyframes confetti {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes bounceIn {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }
            50% {
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        @keyframes glow {
            0% {
                box-shadow: 0 5px 15px rgba(255,71,87,0.3);
            }
            100% {
                box-shadow: 0 5px 25px rgba(255,71,87,0.6);
            }
        }

        .hidden {
            display: none !important;
        }

        .fade-in {
            animation: fadeInUp 0.5s ease-out;
        }

        .slide-in {
            animation: slideInUp 0.5s ease-out;
        }

        @media (max-width: 768px) {
            .app {
                padding: 10px;
            }
            
            .card {
                padding: 20px;
            }
            
            .main-content {
                gap: 20px;
            }
            
            .media {
                height: 250px;
            }
            
            .scenario-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
  </style>
</head>
<body>
    <div class="app">
        <!-- ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
        <div class="card start-screen" id="startScreen">
    <header>
      <div class="logo">ğŸ¥</div>
      <div class="header-content">
        <h1>äººå·¥å‘¼å¸å™¨ãƒˆãƒ©ãƒ–ãƒ«å¯¾å¿œãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚¢ãƒ—ãƒª</h1>
                    <p>è‡¨åºŠå·¥å­¦æŠ€å£«ãƒ»çœ‹è­·å¸«ãƒ»ç ”ä¿®åŒ»å‘ã‘ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ  - ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç‰ˆ</p>
      </div>
    </header>
            <div class="start-screen">
                <h2>å­¦ç¿’ã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ</h2>
                <p>ã“ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚¢ãƒ—ãƒªã§ã¯ã€äººå·¥å‘¼å¸å™¨ã®é«˜åœ§ã‚¢ãƒ©ãƒ¼ãƒ ç™ºç”Ÿæ™‚ã®å¯¾å¿œæ‰‹é †ã‚’å­¦ç¿’ã§ãã¾ã™ã€‚<br>
                å‹•ç”»ã‚’ç¢ºèªã—ã€é©åˆ‡ãªå¯¾å¿œã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>
                
                <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; margin-top: 30px;">
                    <button class="start-btn" onclick="startBranchingScenario('high_pressure')" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);">å­¦ç¿’é–‹å§‹</button>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: rgba(0,212,255,0.1); border-radius: 10px; border: 1px solid rgba(0,212,255,0.3);">
                    <p style="margin: 0; color: var(--accent); font-weight: 600;">ğŸ†• Branching Scenario Learning</p>
                    <p style="margin: 5px 0 0; font-size: 14px; color: var(--muted);">é¸æŠã«ã‚ˆã£ã¦ç•°ãªã‚‹å±•é–‹ã‚’ä½“é¨“ã§ãã‚‹ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–å­¦ç¿’å½¢å¼</p>
                </div>
      </div>
    </div>

        <!-- ã‚·ãƒŠãƒªã‚ªç”»é¢ -->
        <div class="card scenario-container" id="scenarioContainer">
            <div class="scenario-header">
                <div>
                    <span class="alarm-badge" id="alarmBadge">äººå·¥å‘¼å¸å™¨ãƒˆãƒ©ãƒ–ãƒ«å¯¾å¿œãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚¢ãƒ—ãƒª</span>
                    <div class="progress-info">
                        <span id="progressText">åˆ†å²ã‚·ãƒŠãƒªã‚ªé€²è¡Œä¸­</span>
          </div>
          </div>
          </div>

            <div class="main-content">
                <!-- ãƒ¡ãƒ‡ã‚£ã‚¢ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="media-section">
                    <h3>ğŸ“¹ ã‚¢ãƒ©ãƒ¼ãƒ å‹•ç”»</h3>
                    <div class="media">
                        <video id="alarmVideo" controls playsinline webkit-playsinline preload="metadata" controlslist="nodownload noplaybackrate" disablepictureinpicture>
                            <source src="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMWF2YzEAAAAIZnJlZQAAASxtZGF0AQAAAgABBgAAABhhdXRoAAAA" type="video/mp4">
                            ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯å‹•ç”»å†ç”Ÿã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚
                        </video>
          </div>
                    <div class="media-controls">
                        <button class="control-btn" onclick="toggleVideo()">â¯ï¸ å‹•ç”»å†ç”Ÿ/åœæ­¢</button>
            </div>
          </div>

                <!-- ã‚¯ã‚¤ã‚ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="quiz-section">
                    <div class="quiz-content">
                        <h3>ğŸ“ å¯¾å¿œé¸æŠ</h3>
                        <div class="question" id="questionText">
                            Q1. å³ã®å‹•ç”»ã‚’å†ç”Ÿã—ã€ã‚¢ãƒ©ãƒ¼ãƒ å†…å®¹ã‚’ç¢ºèªå¾Œã€ã©ã®å¯¾å¿œã‚’ã¾ãšè¡Œã„ã¾ã™ã‹ï¼Ÿ
        </div>
                        <div class="choices" id="choicesContainer">
                            <!-- é¸æŠè‚¢ã¯JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
            </div>
                        <div class="action-buttons" id="actionButtons">
                            <button class="btn btn-primary" id="submitBtn" onclick="submitAnswer()" disabled>å›ç­”ã™ã‚‹</button>
            </div>
                        <div class="result-banner hidden" id="resultBanner">
                            <span class="result-icon" id="resultIcon">ğŸ‰</span>
                            <div id="resultText">æ­£è§£ï¼</div>
          </div>
                        <div class="explanation hidden" id="explanation">
                            <h4>ğŸ’¡ è§£èª¬</h4>
                            <p id="explanationText"></p>
                        </div>
                    </div>
                    <div class="quiz-actions">
                        <div class="action-buttons">
                            <button class="btn btn-secondary" id="nextBtn" onclick="nextScenario()" style="display: none;">æ¬¡ã®å•é¡Œã¸</button>
                            <button class="btn btn-secondary" id="finishBtn" onclick="showResults()" style="display: none;">çµæœã‚’ç¢ºèª</button>
                        </div>
              </div>
            </div>
          </div>

          </div>

  </div>

  <script>
        // ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ï¼šé«˜åœ§ã‚¢ãƒ©ãƒ¼ãƒ ã‚·ãƒŠãƒªã‚ªã®ã¿
        const branchingScenarios = {
            high_pressure: {
                id: 'high_pressure',
                name: 'é«˜åœ§ã‚¢ãƒ©ãƒ¼ãƒ ',
                startNode: 'q1_initial',
                nodes: {
                    'q1_initial': {
                        question: 'Q1-1. å³ã®å‹•ç”»ã‚’å†ç”Ÿã—ã€ã‚¢ãƒ©ãƒ¼ãƒ å†…å®¹ã‚’ç¢ºèªå¾Œã€ã©ã®å¯¾å¿œã‚’ã¾ãšè¡Œã„ã¾ã™ã‹ï¼Ÿ',
                videoSrc: 'https://example.com/high_pressure_alarm.mp4', // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å‹•ç”»URLã«å¤‰æ›´
                choices: [
                            { text: 'æ‚£è€…ã®æ°—é“ã‚’ç¢ºèªã—ã€å¿…è¦ã«å¿œã˜ã¦ç—°ã‚’å¸å¼•ã™ã‚‹', next: 'q2_circuit_check', correct: true },
                            { text: 'äººå·¥å‘¼å¸å™¨ã®è¨­å®šåœ§ã‚’ä¸‹ã’ã‚‹', next: 'q2_spo2_drop', correct: false },
                            { text: 'æ‚£è€…ã®ä½“ä½ã‚’å¤‰æ›´ã™ã‚‹', next: 'q2_spo2_drop', correct: false },
                            { text: 'äººå·¥å‘¼å¸å™¨ã‚’ä¸€æ™‚åœæ­¢ã™ã‚‹', next: 'q2_spo2_drop', correct: false }
                        ]
                    },
                    'q2_circuit_check': {
                        question: 'Q1-2. å›è·¯ã«å±ˆæ›²ã‚’ç™ºè¦‹ã—ã¾ã—ãŸã€‚ã©ã†ã—ã¾ã™ã‹ï¼Ÿ',
                        choices: [
                            { text: 'å±ˆæ›²ã‚’ç›´ã™', next: 'success', correct: true },
                            { text: 'ãƒã‚®ãƒ³ã‚°ã™ã‚‹', next: 'failure', correct: false }
                        ]
                    },
                    'q2_spo2_drop': {
                        question: 'Q1-2. ã‚¢ãƒ©ãƒ¼ãƒ éŸ³ã¯æ­¢ã¾ã‚Šã¾ã—ãŸãŒã€æ‚£è€…ã®SpOâ‚‚ãŒä½ä¸‹ã—å§‹ã‚ã¾ã—ãŸï¼ã©ã†ã—ã¾ã™ã‹ï¼Ÿ',
                        choices: [
                            { text: 'å›è·¯ã‚’ç¢ºèªã™ã‚‹', next: 'q2_circuit_check', correct: true },
                            { text: 'è¨­å®šåœ§ã‚’ä¸‹ã’ã‚‹', next: 'failure', correct: false }
                        ]
                    },
                    'success': {
                        type: 'ending',
                        message: 'âœ… å±ˆæ›²ã‚’ç›´ã—ã¦ã‚¢ãƒ©ãƒ¼ãƒ ãŒè§£é™¤ã•ã‚Œã¾ã—ãŸï¼<br>ã‚·ãƒŠãƒªã‚ªã‚¯ãƒªã‚¢ï¼ğŸ‰',
                        correct: true
                    },
                    'failure': {
                        type: 'ending',
                        message: 'âŒ å¯¾å¿œãŒé…ã‚Œã€SpOâ‚‚ãŒã•ã‚‰ã«ä½ä¸‹ã—ã¾ã—ãŸã€‚<br>ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã—ã¾ã—ã‚‡ã†ã€‚',
                        correct: false
                    }
                }
            }
        };

        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹
        let isAnswered = false;
        
        // åˆ†å²å‹ã‚·ãƒŠãƒªã‚ªç”¨ã®çŠ¶æ…‹
        let currentBranchingScenario = null;
        let currentNodeId = null;
        let branchingAnswers = [];
        let hasShownExplanation = false;

        // åˆæœŸåŒ–
        function init() {
            // ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç‰ˆã§ã¯å±¥æ­´æ©Ÿèƒ½ã¯ç°¡ç•¥åŒ–
            checkAccess();
        }

        // ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
        function checkAccess() {
            const password = prompt('ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
            if (password !== 'ventilator2024') {
                alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚');
                window.location.href = 'about:blank';
            }
        }

        // åˆ†å²å‹ã‚·ãƒŠãƒªã‚ªé–‹å§‹
        function startBranchingScenario(scenarioId) {
            console.log('startBranchingScenario called with:', scenarioId);
            
            if (!branchingScenarios[scenarioId]) {
                console.error('Scenario not found:', scenarioId);
                alert('ã‚·ãƒŠãƒªã‚ªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ' + scenarioId);
                return;
            }
            
            currentBranchingScenario = branchingScenarios[scenarioId];
            currentNodeId = currentBranchingScenario.startNode;
            branchingAnswers = [];
            hasShownExplanation = false;
            
            console.log('Starting scenario:', currentBranchingScenario);
            console.log('Start node:', currentNodeId);
            
            // ç”»é¢ã‚’åˆ‡ã‚Šæ›¿ãˆ
            const startScreen = document.getElementById('startScreen');
            const scenarioContainer = document.getElementById('scenarioContainer');
            
            if (startScreen) {
                startScreen.classList.add('hidden');
            }
            
            if (scenarioContainer) {
                scenarioContainer.classList.add('active');
            }
            
            loadBranchingNode();
        }

        // åˆ†å²å‹ãƒãƒ¼ãƒ‰èª­ã¿è¾¼ã¿
        function loadBranchingNode() {
            console.log('loadBranchingNode called');
            console.log('currentNodeId:', currentNodeId);
            
            const node = currentBranchingScenario.nodes[currentNodeId];
            console.log('Current node:', node);
            
            if (!node) {
                console.error('Node not found:', currentNodeId);
                alert('ãƒãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ' + currentNodeId);
                return;
            }
            
            isAnswered = false;

            // ã‚¢ãƒ©ãƒ¼ãƒ ãƒãƒƒã‚¸ã¨ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°
            document.getElementById('alarmBadge').textContent = 'äººå·¥å‘¼å¸å™¨ãƒˆãƒ©ãƒ–ãƒ«å¯¾å¿œãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚¢ãƒ—ãƒª';
            document.getElementById('progressText').textContent = 'åˆ†å²ã‚·ãƒŠãƒªã‚ªé€²è¡Œä¸­';

            // è³ªå•æ–‡æ›´æ–°
            document.getElementById('questionText').textContent = node.question;

            // åˆ†å²å‹ã‚·ãƒŠãƒªã‚ªã§ã¯ã€Œå›ç­”ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
            const actionButtons = document.getElementById('actionButtons');
            if (actionButtons) {
                actionButtons.style.display = 'none';
            }

            // çµæœãƒãƒŠãƒ¼ã‚’éè¡¨ç¤º
            const resultBanner = document.getElementById('resultBanner');
            if (resultBanner) {
                resultBanner.classList.add('hidden');
            }

            // è§£èª¬ã‚’éè¡¨ç¤º
            const explanation = document.getElementById('explanation');
            if (explanation) {
                explanation.classList.add('hidden');
            }

            // å‹•ç”»æ›´æ–°ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰
            if (node.videoSrc) {
                const video = document.getElementById('alarmVideo');
                if (video) {
                    video.src = node.videoSrc;
                    video.load();
                    console.log('Video updated:', node.videoSrc);
                    
                    // å‹•ç”»ã®èª­ã¿è¾¼ã¿å®Œäº†ã‚’å¾…ã¤ï¼ˆè‡ªå‹•å†ç”Ÿã¯ã—ãªã„ï¼‰
                    video.addEventListener('loadeddata', function() {
                        console.log('Video loaded successfully');
                    }, { once: true });
                } else {
                    console.error('Video element not found');
                }
            }

            // é¸æŠè‚¢æ›´æ–°
            const choicesContainer = document.getElementById('choicesContainer');
            console.log('choicesContainer:', choicesContainer);
            
            if (!choicesContainer) {
                console.error('choicesContainer element not found');
                return;
            }
            
            choicesContainer.innerHTML = '';
            
            console.log('node.choices:', node.choices);
            if (node.choices && node.choices.length > 0) {
            // é¸æŠè‚¢ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ä¸¦ã³æ›¿ãˆ
                const shuffledChoices = [...node.choices];
            for (let i = shuffledChoices.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledChoices[i], shuffledChoices[j]] = [shuffledChoices[j], shuffledChoices[i]];
            }
            
            shuffledChoices.forEach((choice, index) => {
                    console.log('Creating choice:', choice, 'index:', index);
                    const choiceDiv = document.createElement('div');
                    choiceDiv.className = 'choice';
                    
                    // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‚’ä½œæˆ
                    const radioInput = document.createElement('input');
                    radioInput.type = 'radio';
                    radioInput.name = 'branchingChoice';
                    radioInput.id = `choice_${index}`;
                    radioInput.value = index;
                    
                    // ãƒ©ãƒ™ãƒ«ã‚’ä½œæˆ
                const label = document.createElement('label');
                    label.htmlFor = `choice_${index}`;
                    label.textContent = choice.text;
                    
                    // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
                    choiceDiv.onclick = () => {
                        radioInput.checked = true;
                        selectBranchingChoice(choice, index);
                    };
                    
                    // ãƒ©ãƒ™ãƒ«ã«ã‚‚ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
                    label.onclick = (e) => {
                        e.stopPropagation();
                        radioInput.checked = true;
                        selectBranchingChoice(choice, index);
                    };
                    
                    // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã¨ãƒ©ãƒ™ãƒ«ã‚’è¿½åŠ 
                    choiceDiv.appendChild(radioInput);
                    choiceDiv.appendChild(label);
                    choicesContainer.appendChild(choiceDiv);
                });
                console.log('Choices created successfully with random order');
            } else {
                console.error('No choices found in node');
            }
        }

        // åˆ†å²å‹é¸æŠè‚¢é¸æŠ
        function selectBranchingChoice(choice, index) {
            if (isAnswered) return;
            isAnswered = true;

            // éŸ³åŠ¹æœã‚’å†ç”Ÿ
            if (choice.correct) {
                playCorrectSound();
            } else {
                playIncorrectSound();
            }

            // è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’è¡¨ç¤º
            showBranchingResult(choice.correct);

            // å›ç­”ã‚’è¨˜éŒ²
            branchingAnswers.push({
                nodeId: currentNodeId,
                choice: choice.text,
                correct: choice.correct,
                timestamp: new Date().toISOString()
            });

            // æ¬¡ã®ãƒãƒ¼ãƒ‰ã«ç§»å‹•ï¼ˆè¡¨ç¤ºå¾Œã«ï¼‰
            setTimeout(() => {
                if (choice.next === 'success' || choice.next === 'failure') {
                    showBranchingEnding(choice.next);
                } else {
                    currentNodeId = choice.next;
                    loadBranchingNode();
                }
            }, 2000); // 2ç§’é–“è¡¨ç¤ºã—ã¦ã‹ã‚‰æ¬¡ã¸
        }

        // åˆ†å²å‹çµæœè¡¨ç¤º
        function showBranchingResult(isCorrect) {
            const resultBanner = document.getElementById('resultBanner');
            const resultIcon = document.getElementById('resultIcon');
            const resultText = document.getElementById('resultText');
            
            if (isCorrect) {
                resultBanner.className = 'result-banner correct';
                resultIcon.textContent = 'ğŸ‰';
                resultText.textContent = 'æ­£è§£ï¼';
                
                // è§£èª¬ã‚’è¡¨ç¤º
                if (hasShownExplanation) {
                    const explanation = document.getElementById('explanation');
                    const explanationText = document.getElementById('explanationText');
                    if (explanation && explanationText) {
                        explanationText.textContent = 'é«˜åœ§ã‚¢ãƒ©ãƒ¼ãƒ ãŒç™ºç”Ÿã—ãŸå ´åˆã€ã¾ãšæ‚£è€…ã®æ°—é“ã«å•é¡ŒãŒãªã„ã‹ç¢ºèªã—ã€å¿…è¦ã«å¿œã˜ã¦ç—°ã®å¸å¼•ã‚’è¡Œã„ã¾ã™ã€‚æ°—é“ã®é–‰å¡ãŒé«˜åœ§ã®åŸå› ã¨ãªã‚‹ã“ã¨ãŒå¤šã„ãŸã‚ã§ã™ã€‚';
                        explanation.classList.remove('hidden');
                    }
                }
                
                hasShownExplanation = true;
            } else {
                resultBanner.className = 'result-banner incorrect';
                resultIcon.textContent = 'âŒ';
                resultText.textContent = 'ä¸æ­£è§£';
            }
            resultBanner.classList.remove('hidden');
        }

        // åˆ†å²å‹çµ‚äº†è¡¨ç¤º
        function showBranchingEnding(endingType) {
            const node = currentBranchingScenario.nodes[endingType];
            const questionText = document.getElementById('questionText');
            const choicesContainer = document.getElementById('choicesContainer');
            
            if (endingType === 'success') {
                // æˆåŠŸæ™‚ã¯å®Œäº†ç”»é¢ã‚’è¡¨ç¤º
                showPresentationCompleted();
            } else {
                // å¤±æ•—æ™‚ã¯å†æŒ‘æˆ¦ç”»é¢
                questionText.innerHTML = node.message;
                choicesContainer.innerHTML = '';

                const retryBtn = document.createElement('button');
                retryBtn.className = 'start-btn';
                retryBtn.textContent = 'ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦';
                retryBtn.onclick = () => startBranchingScenario('high_pressure');
                choicesContainer.appendChild(retryBtn);

                const backBtn = document.createElement('button');
                backBtn.className = 'start-btn';
                backBtn.textContent = 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹';
                backBtn.onclick = () => {
                    document.getElementById('scenarioContainer').classList.remove('active');
                    document.getElementById('startScreen').classList.remove('hidden');
                };
                choicesContainer.appendChild(backBtn);
            }
        }

        // ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†ç”»é¢
        function showPresentationCompleted() {
            const questionText = document.getElementById('questionText');
            const choicesContainer = document.getElementById('choicesContainer');
            
            // ç´™å¹é›ªã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’é–‹å§‹
            createConfetti();
            
            // å®Œäº†ç”»é¢ã®HTMLã‚’ä½œæˆ
            const completionHTML = `
                <div class="completion-screen">
                    <div class="completion-title">ğŸ‰ ã‚·ãƒŠãƒªã‚ªå®Œäº†ï¼ ğŸ‰</div>
                    <div class="completion-message">ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼<br>é«˜åœ§ã‚¢ãƒ©ãƒ¼ãƒ å¯¾å¿œã®å­¦ç¿’ã‚’å®Œäº†ã—ã¾ã—ãŸã€‚</div>
                    
                    <div class="completion-stats">
                        <div class="stat-item">
                            <span class="stat-number">1</span>
                            <div class="stat-label">å®Œäº†ã‚·ãƒŠãƒªã‚ªæ•°</div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">100%</span>
                            <div class="stat-label">å­¦ç¿’å®Œäº†ç‡</div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">ğŸ†</span>
                            <div class="stat-label">é”æˆãƒ¬ãƒ™ãƒ«</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <p style="color: var(--muted); font-size: 14px; line-height: 1.4;">
                            é«˜åœ§ã‚¢ãƒ©ãƒ¼ãƒ å¯¾å¿œã«ã¤ã„ã¦å®Ÿè·µçš„ãªçŸ¥è­˜ã‚’èº«ã«ã¤ã‘ã¾ã—ãŸã€‚<br>
                            å®Ÿéš›ã®è‡¨åºŠç¾å ´ã§ã‚‚è‡ªä¿¡ã‚’æŒã£ã¦å¯¾å¿œã§ãã‚‹ã§ã—ã‚‡ã†ï¼
                        </p>
                    </div>
                </div>
            `;
            
            questionText.innerHTML = completionHTML;
            choicesContainer.innerHTML = '';

            // ãƒœã‚¿ãƒ³ã‚’ä½œæˆ
            const restartBtn = document.createElement('button');
            restartBtn.className = 'start-btn';
            restartBtn.textContent = 'ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦';
            restartBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            restartBtn.onclick = () => startBranchingScenario('high_pressure');
            choicesContainer.appendChild(restartBtn);

            const backBtn = document.createElement('button');
            backBtn.className = 'start-btn';
            backBtn.textContent = 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹';
            backBtn.style.background = 'linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%)';
            backBtn.onclick = () => {
                document.getElementById('scenarioContainer').classList.remove('active');
                document.getElementById('startScreen').classList.remove('hidden');
            };
            choicesContainer.appendChild(backBtn);

            const exitBtn = document.createElement('button');
            exitBtn.className = 'start-btn';
            exitBtn.textContent = 'çµ‚äº†ã™ã‚‹';
            exitBtn.style.background = 'linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%)';
            exitBtn.onclick = () => {
                if (confirm('å­¦ç¿’ã‚’çµ‚äº†ã—ã¾ã™ã‹ï¼Ÿ')) {
                    if (window.close) {
                        window.close();
                    } else {
                        alert('ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¿ãƒ–ã‚’é–‰ã˜ã¦å­¦ç¿’ã‚’çµ‚äº†ã—ã¦ãã ã•ã„ã€‚');
                    }
                }
            };
            choicesContainer.appendChild(exitBtn);
        }

        // ç´™å¹é›ªã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        function createConfetti() {
            const colors = ['#00d4ff', '#00ff88', '#ffb800', '#ff4757'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.animationDelay = Math.random() * 3 + 's';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.width = (Math.random() * 8 + 4) + 'px';
                    confetti.style.height = confetti.style.width;
                    document.body.appendChild(confetti);
                    
                    // 3ç§’å¾Œã«å‰Šé™¤
                    setTimeout(() => {
                        if (confetti.parentNode) {
                            confetti.parentNode.removeChild(confetti);
                        }
                    }, 3000);
                }, i * 50);
            }
        }

        // æ­£è§£éŸ³å†ç”Ÿ
        function playCorrectSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.1);
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        // ä¸æ­£è§£éŸ³å†ç”Ÿ
        function playIncorrectSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
            oscillator.type = 'square';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        // å‹•ç”»å†ç”Ÿ/åœæ­¢
        function toggleVideo() {
            const video = document.getElementById('alarmVideo');
            if (video.paused) {
                video.play().catch(e => {
                    console.log('å‹•ç”»å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                    alert('å‹•ç”»ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                });
            } else {
                video.pause();
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            init();
        });
  </script>
</body>
</html>
